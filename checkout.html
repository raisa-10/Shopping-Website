<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout - ShopEasy</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background: linear-gradient(180deg,#f6fbff,#eef6ff);
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 36px 18px;
    }

    .checkout-wrapper {
      width: 100%;
      max-width: 1100px;
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 22px;
      align-items: start;
    }

    .billing-card, .summary-card {
      background: #fff;
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 18px 40px rgba(12,24,56,0.06);
    }

    .billing-card h2, .summary-card h2 { margin-bottom: 12px; color: #123064; }

    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 12px;
    }

    .field label { font-size: 0.92rem; color: #333; }
    .field input, .field textarea, .field select {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #e6eefb;
      outline: none;
      font-size: 0.95rem;
      background: #fff;
    }

    .flex-row { display: flex; gap: 12px; }
    .flex-row .field { flex: 1; }

    .summary-list { list-style: none; padding: 0; margin: 0; max-height: 420px; overflow-y: auto; }
    .summary-item { display: flex; gap: 12px; align-items: center; padding: 10px 0; border-bottom: 1px dashed #f1f5ff; }
    .summary-item img { width: 62px; height: 62px; object-fit: contain; border-radius: 8px; }

    .summary-bottom { margin-top: 14px; display: flex; justify-content: space-between; align-items: center; }
    .place-actions { display:flex; gap:12px; margin-top: 16px; }

    .btn {
      padding: 12px 18px;
      border-radius: 10px;
      border: none;
      font-weight: 700;
      cursor: pointer;
    }
    .btn-primary {
      background: linear-gradient(90deg,#0b74ff,#005bb5);
      color: #fff;
    }
    .btn-secondary { background: transparent; border: 1px solid #dbeafe; color: #0b3a8a; }

    .notice {
      background: #eaf3ff;
      border-left: 5px solid #0b74ff;
      color: #123064;
      padding: 10px 12px;
      border-radius: 8px;
      font-weight: 600;
      margin-bottom: 12px;
      display: none;
    }

    .offer-applied {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      color: #fff;
      padding: 12px;
      border-radius: 10px;
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(67, 233, 123, 0.3);
    }

    .offer-applied .icon {
      font-size: 1.5rem;
    }

    .discount-row {
      color: #16a34a;
      font-weight: 700;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px dashed #f1f5ff;
    }

    .summary-row.total {
      border-top: 2px solid #0b74ff;
      border-bottom: none;
      padding-top: 12px;
      margin-top: 8px;
      font-size: 1.15rem;
      font-weight: 800;
    }

    @media (max-width: 980px) {
      .checkout-wrapper { grid-template-columns: 1fr; padding: 0 6px; }
      .summary-card { order: 2; }
    }
  </style>
</head>
<body>
  <div class="checkout-wrapper">
    <div class="billing-card">
      <h2>Billing & Shipping</h2>

      <div id="notice" class="notice"></div>

      <form id="billingForm" autocomplete="on">
        <div class="field">
          <label for="name">Full name</label>
          <input id="name" type="text" required placeholder="Your name" />
        </div>

        <div class="field">
          <label for="phone">Mobile number</label>
          <input id="phone" type="tel" required placeholder="+91" />
        </div>

        <div class="field">
          <label for="address">Address</label>
          <textarea id="address" rows="3" required placeholder="Street, Area, City, State, PIN"></textarea>
        </div>

        <div class="field">
          <label for="payment">Payment method</label>
          <select id="payment" required>
            <option value="cod">Cash on Delivery (COD)</option>
            <option value="card">Debit/Credit Card</option>
            <option value="upi">UPI (10% Cashback)</option>
          </select>
        </div>

        <div id="cardFields" style="display:none;">
          <div class="flex-row">
            <div class="field">
              <label for="cardNo">Card number</label>
              <input id="cardNo" type="text" placeholder="4242 4242 4242 4242" />
            </div>
            <div class="field">
              <label for="expiry">Expiry</label>
              <input id="expiry" type="text" placeholder="MM/YY" />
            </div>
            <div class="field">
              <label for="cvv">CVV</label>
              <input id="cvv" type="text" placeholder="123" />
            </div>
          </div>
        </div>

        <div id="upiFields" style="display:none;">
          <div class="field">
            <label for="upiId">UPI ID</label>
            <input id="upiId" type="text" placeholder="yourname@upi" />
          </div>
        </div>

        <div class="place-actions">
          <button type="submit" class="btn btn-primary">Place Order</button>
          <button type="button" id="backToShop" class="btn btn-secondary">Back to Shop</button>
        </div>
      </form>
    </div>

    <aside class="summary-card">
      <h2>Order Summary</h2>
      
      <div id="offerApplied" class="offer-applied" style="display: none;">
        <span class="icon">ðŸŽ‰</span>
        <div>
          <strong>Offer Applied!</strong>
          <div style="font-size: 0.9rem; opacity: 0.95;" id="offerDescription"></div>
        </div>
      </div>

      <ul id="checkoutList" class="summary-list"></ul>
      
      <div class="summary-row">
        <div style="color:#6b7280">Subtotal</div>
        <div style="font-weight:700;">â‚¹<span id="checkoutSubtotal">0.00</span></div>
      </div>

      <div class="summary-row discount-row" id="discountRow" style="display: none;">
        <div>Discount (20%)</div>
        <div>-â‚¹<span id="checkoutDiscount">0.00</span></div>
      </div>

      <div class="summary-row" id="cashbackRow" style="display: none; color: #16a34a;">
        <div>UPI Cashback (10%)</div>
        <div>â‚¹<span id="checkoutCashback">0.00</span></div>
      </div>

      <div class="summary-row">
        <div style="color:#6b7280">Shipping</div>
        <div style="font-weight:700;">â‚¹<span id="checkoutShipping">0.00</span></div>
      </div>

      <div class="summary-row total">
        <div>Total</div>
        <div style="font-size:1.3rem; color: #0b3a8a;">â‚¹<span id="checkoutTotal">0.00</span></div>
      </div>
    </aside>
  </div>

  <script>
    const INR_RATE = 82;
    const checkoutList = document.getElementById("checkoutList");
    const checkoutSubtotal = document.getElementById("checkoutSubtotal");
    const checkoutDiscount = document.getElementById("checkoutDiscount");
    const checkoutCashback = document.getElementById("checkoutCashback");
    const checkoutShipping = document.getElementById("checkoutShipping");
    const checkoutTotal = document.getElementById("checkoutTotal");
    const discountRow = document.getElementById("discountRow");
    const cashbackRow = document.getElementById("cashbackRow");
    const offerApplied = document.getElementById("offerApplied");
    const offerDescription = document.getElementById("offerDescription");
    const billingForm = document.getElementById("billingForm");
    const backToShop = document.getElementById("backToShop");
    const paymentSelect = document.getElementById("payment");
    const cardFields = document.getElementById("cardFields");
    const upiFields = document.getElementById("upiFields");
    const notice = document.getElementById("notice");

    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    function showNotice(msg) {
      notice.textContent = msg;
      notice.style.display = "block";
      setTimeout(() => (notice.style.display = "none"), 4000);
    }

    function formatINR(val) {
      return Number(val).toFixed(2);
    }

    function renderCheckout() {
      checkoutList.innerHTML = "";
      let subtotalINR = 0;
      cart.forEach(item => {
        const priceINR = Number(item.priceUSD) * INR_RATE;
        const itemTotal = priceINR * item.quantity;
        subtotalINR += itemTotal;

        const li = document.createElement("li");
        li.className = "summary-item";
        li.innerHTML = `
          <img src="${item.image}" alt="${item.title}">
          <div style="flex:1;">
            <div style="font-weight:700">${item.title.length>48?item.title.slice(0,48)+"â€¦":item.title}</div>
            <div style="color:#6b7280; font-size:0.95rem">â‚¹${formatINR(priceINR)} Ã— ${item.quantity}</div>
          </div>
          <div style="font-weight:800">â‚¹${formatINR(itemTotal)}</div>
        `;
        checkoutList.appendChild(li);
      });

      // Calculate discount (20% off on orders above â‚¹2000)
      let discount = 0;
      let offerText = "";
      if (subtotalINR >= 2000) {
        discount = subtotalINR * 0.20;
        discountRow.style.display = "flex";
        offerApplied.style.display = "flex";
        offerText = "You saved 20% on your order!";
      } else {
        discountRow.style.display = "none";
        offerApplied.style.display = "none";
      }

      // Calculate shipping (free on orders above â‚¹2000)
      let shipping = subtotalINR >= 2000 || subtotalINR === 0 ? 0 : 50;
      if (subtotalINR >= 2000) {
        offerText += " Free shipping included.";
      }

      offerDescription.textContent = offerText;

      const afterDiscount = subtotalINR - discount;
      const total = afterDiscount + shipping;

      checkoutSubtotal.textContent = formatINR(subtotalINR);
      checkoutDiscount.textContent = formatINR(discount);
      checkoutShipping.textContent = formatINR(shipping);
      checkoutTotal.textContent = formatINR(total);
    }

    renderCheckout();

    paymentSelect.addEventListener('change', () => {
      if (paymentSelect.value === 'card') {
        cardFields.style.display = 'block';
        upiFields.style.display = 'none';
        cashbackRow.style.display = 'none';
      } else if (paymentSelect.value === 'upi') {
        cardFields.style.display = 'none';
        upiFields.style.display = 'block';
        // Show UPI cashback
        let subtotalINR = 0;
        cart.forEach(item => {
          const priceINR = Number(item.priceUSD) * INR_RATE;
          subtotalINR += priceINR * item.quantity;
        });
        const discount = subtotalINR >= 2000 ? subtotalINR * 0.20 : 0;
        const afterDiscount = subtotalINR - discount;
        const cashback = afterDiscount * 0.10;
        checkoutCashback.textContent = formatINR(cashback);
        cashbackRow.style.display = "flex";
      } else {
        cardFields.style.display = 'none';
        upiFields.style.display = 'none';
        cashbackRow.style.display = 'none';
      }
    });

    billingForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!cart || cart.length === 0) {
        showNotice("Your cart is empty. Add items to place an order.");
        setTimeout(() => (window.location.href = "index.html"), 2000);
        return;
      }

      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      if (!name || !phone || !address) {
        showNotice("Please fill name, phone and address.");
        return;
      }

      if (paymentSelect.value === 'card') {
        const cardNo = document.getElementById('cardNo').value.trim();
        const expiry = document.getElementById('expiry').value.trim();
        const cvv = document.getElementById('cvv').value.trim();
        if (cardNo.length < 12 || cvv.length < 3) {
          showNotice("Please enter valid card details.");
          return;
        }
      }

      if (paymentSelect.value === 'upi') {
        const upiId = document.getElementById('upiId').value.trim();
        if (!upiId || !upiId.includes('@')) {
          showNotice("Please enter a valid UPI ID.");
          return;
        }
      }

      // Success message
      showNotice("âœ… Order placed successfully! Redirecting...");
      localStorage.removeItem("cart");
      setTimeout(() => (window.location.href = "index.html"), 2500);
    });

    backToShop.addEventListener('click', () => {
      window.location.href = "index.html";
    });
  </script>
</body>
</html>
